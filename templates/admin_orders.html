{% extends 'base.html' %}

{% block content %}
<div class="row mb-4 align-items-center mt-4">
    <div class="col d-flex justify-content-between align-items-center page-header mb-0 mt-0">
        <h2 class="fw-bold m-0" style="color: var(--primary-dark);">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Admin)</h2>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-custom rounded-pill">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card shadow-sm border-0" style="border-radius: 16px; overflow: hidden;">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏¥‡∏•</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (ID)</th>
                                <th>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                                <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                                <th>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                                <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td>#{{ order.id }}</td>
                                <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td>{{ order.user.username }} ({{ order.user_id }})</td>
                                <td>‡∏ø{{ "%.2f"|format(order.total_price) }}</td>
                                <td style="max-width: 200px; white-space: pre-wrap; font-size: 0.9em;">{{ order.address
                                    }}</td>
                                <td>
                                    {% if order.payment_slip %}
                                    <a href="{{ order.payment_slip }}" target="_blank"
                                        class="btn btn-sm btn-info text-white">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>
                                    {% else %}
                                    <span class="text-muted small">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% set status_color = 'secondary' %}
                                    {% if order.status == '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' %}{% set status_color = 'warning text-dark'
                                    %}{% endif %}
                                    {% if order.status == '‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö' %}{% set status_color = 'info text-dark' %}{%
                                    endif %}
                                    {% if order.status == '‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏á' %}{% set status_color = 'primary' %}{% endif %}
                                    {% if order.status == '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' %}{% set status_color = 'success' %}{% endif %}
                                    <span class="badge bg-{{ status_color }}">{{ order.status }}</span>
                                </td>
                                <td>
                                    <form method="POST" action="{{ url_for('update_order_status', order_id=order.id) }}"
                                        class="d-flex">
                                        <select name="status" class="form-select form-select-sm me-2"
                                            style="width: 130px;">
                                            <option value="‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" {% if order.status=='‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' %}selected{%
                                                endif %}>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                            <option value="‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö" {% if order.status=='‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö' %}selected{%
                                                endif %}>‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö</option>
                                            <option value="‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏á" {% if order.status=='‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏á' %}selected{%
                                                endif %}>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏á</option>
                                            <option value="‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" {% if order.status=='‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' %}selected{%
                                                endif %}>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                                        </select>
                                        <button type="submit" class="btn btn-sm btn-outline-custom">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="7" class="text-center py-4 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}